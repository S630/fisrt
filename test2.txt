/****** Object: UserDefinedFunction [dbo].[daily_udf_datagth_rpt11_02] Script Date: 08/08/2017 13:56:10 ******/ SET ANSI_NULLS
    ON GO SET QUOTED_IDENTIFIER
    ON GO create FUNCTION [dbo].[daily_udf_datagth_rpt11_02] ( @arg_branch VARCHAR(6) , --统计机构-->管理机构 @arg_branch_level CHAR(1) , --统计机构级别：0--本级；1--直属下级；2--所有分支机构； @arg_ins VARCHAR(8) , --统计险种-->险种代码 @arg_sdate VARCHAR(10) , --统计区间开始日期 @arg_edate VARCHAR(10) --统计区间结束日期 ) RETURNS @result TABLE ( orders SMALLINT , branch CHAR(6) ,--管理渠道ID branchtxt VARCHAR(40) ,--管理渠道名称 ins VARCHAR(8) , mgr CHAR(20) , mgrtxt VARCHAR(100) , statdate SMALLDATETIME , total_sumscale DECIMAL(16, 2) , --城区总保费金额 total_scaleallins decimal(16,2), total_longinsnew DECIMAL(16, 2) , --城区新单保费金额 --total_ynqdqsx DECIMAL(16, 2) , --城区新单保费其中：一年定期寿险 total_longinsnewY DECIMAL(16, 2) , --城区首年期交保费金额 total_longinsnew5 DECIMAL(16, 2) , --城区其中：5年期以下首年期交保费金额 total_longinsnew5_9 DECIMAL(16, 2) , --城区5-9年期以下首年期交保费金额 total_longinsnew10 DECIMAL(16, 2) , --城区10年期及以上首年期交保费金额 total_longinsold DECIMAL(16, 2) , --城区续期保费金额 total_shortins DECIMAL(16, 2) , --城区短期险金额 total_dqywxbf DECIMAL(16, 2) , --城区短期险其中：意外险 total_dqsxbf decimal(16,2), total_otherscale decimal(16,2), urban_sumscale DECIMAL(16, 2) , --城区总保费金额 urban_scaleallins decimal(16,2), urban_longinsnew DECIMAL(16, 2) , --城区新单保费金额 --urban_ynqdqsx DECIMAL(16, 2) , --城区新单保费其中：一年定期寿险 urban_longinsnewY DECIMAL(16, 2) , --城区首年期交保费金额 urban_longinsnew5 DECIMAL(16, 2) , --城区其中：5年期以下首年期交保费金额 urban_longinsnew5_9 DECIMAL(16, 2) , --城区5-9年期以下首年期交保费金额 urban_longinsnew10 DECIMAL(16, 2) , --城区10年期及以上首年期交保费金额 urban_longinsold DECIMAL(16, 2) , --城区续期保费金额 urban_shortins DECIMAL(16, 2) , --城区短期险金额 urban_dqywxbf DECIMAL(16, 2) , --城区短期险其中：意外险 urban_dqsxbf decimal(16,2), urban_otherscale decimal(16,2), suburban_sumscale DECIMAL(16, 2) , --城区总保费金额 suburban_scaleallins decimal(16,2), suburban_longinsnew DECIMAL(16, 2) , --城区新单保费金额 --suburban_ynqdqsx DECIMAL(16, 2) , --城区新单保费其中：一年定期寿险 suburban_longinsnewY DECIMAL(16, 2) , --城区首年期交保费金额 suburban_longinsnew5 DECIMAL(16, 2) , --城区其中：5年期以下首年期交保费金额 suburban_longinsnew5_9 DECIMAL(16, 2) , --城区5-9年期以下首年期交保费金额 suburban_longinsnew10 DECIMAL(16, 2) , --城区10年期及以上首年期交保费金额 suburban_longinsold DECIMAL(16, 2) , --城区续期保费金额 suburban_shortins DECIMAL(16, 2) , --城区短期险金额 suburban_dqywxbf DECIMAL(16, 2) , --城区短期险其中：意外险 suburban_dqsxbf decimal(16,2), suburban_otherscale decimal(16,2), rural_sumscale DECIMAL(16, 2) , --城区总保费金额 rural_scaleallins decimal(16,2), rural_longinsnew DECIMAL(16, 2) , --城区新单保费金额 --rural_ynqdqsx DECIMAL(16, 2) , --城区新单保费其中：一年定期寿险 rural_longinsnewY DECIMAL(16, 2) , --城区首年期交保费金额 rural_longinsnew5 DECIMAL(16, 2) , --城区其中：5年期以下首年期交保费金额 rural_longinsnew5_9 DECIMAL(16, 2) , --城区5-9年期以下首年期交保费金额 rural_longinsnew10 DECIMAL(16, 2) , --城区10年期及以上首年期交保费金额 rural_longinsold DECIMAL(16, 2) , --城区续期保费金额 rural_shortins DECIMAL(16, 2) , --城区短期险金额 rural_dqywxbf DECIMAL(16, 2) , --城区短期险其中：意外险 rural_dqsxbf decimal(16,2), rural_otherscale decimal(16,2) ) AS BEGIN IF ( MONTH(@arg_sdate) = 12
        AND DAY(@arg_sdate) = 31 ) BEGIN INSERT INTO @result ( orders , branch , branchtxt , ins, mgr , mgrtxt , statdate , total_sumscale , --城区总保费金额 total_scaleallins, total_longinsnew , --城区新单保费金额 --total_ynqdqsx , --城区新单保费其中：一年定期寿险 total_longinsnewY , --城区首年期交保费金额 total_longinsnew5 , --城区其中：5年期以下首年期交保费金额 total_longinsnew5_9 , --城区5-9年期以下首年期交保费金额 total_longinsnew10 , --城区10年期及以上首年期交保费金额 total_longinsold , --城区续期保费金额 total_shortins , --城区短期险金额 total_dqywxbf , --城区短期险其中：意外险 total_dqsxbf, total_otherscale, urban_sumscale , --城区总保费金额 urban_scaleallins, urban_longinsnew , --城区新单保费金额 --urban_ynqdqsx , --城区新单保费其中：一年定期寿险 urban_longinsnewY , --城区首年期交保费金额 urban_longinsnew5 , --城区其中：5年期以下首年期交保费金额 urban_longinsnew5_9 , --城区5-9年期以下首年期交保费金额 urban_longinsnew10 , --城区10年期及以上首年期交保费金额 urban_longinsold , --城区续期保费金额 urban_shortins , --城区短期险金额 urban_dqywxbf , --城区短期险其中：意外险 urban_dqsxbf, urban_otherscale, suburban_sumscale , --城区总保费金额 suburban_scaleallins, suburban_longinsnew , --城区新单保费金额 --suburban_ynqdqsx , --城区新单保费其中：一年定期寿险 suburban_longinsnewY , --城区首年期交保费金额 suburban_longinsnew5 , --城区其中：5年期以下首年期交保费金额 suburban_longinsnew5_9 , --城区5-9年期以下首年期交保费金额 suburban_longinsnew10 , --城区10年期及以上首年期交保费金额 suburban_longinsold , --城区续期保费金额 suburban_shortins , --城区短期险金额 suburban_dqywxbf , --城区短期险其中：意外险 suburban_dqsxbf, suburban_otherscale, rural_sumscale , --城区总保费金额 rural_scaleallins, rural_longinsnew , --城区新单保费金额 --rural_ynqdqsx , --城区新单保费其中：一年定期寿险 rural_longinsnewY , --城区首年期交保费金额 rural_longinsnew5 , --城区其中：5年期以下首年期交保费金额 rural_longinsnew5_9 , --城区5-9年期以下首年期交保费金额 rural_longinsnew10 , --城区10年期及以上首年期交保费金额 rural_longinsold , --城区续期保费金额 rural_shortins , --城区短期险金额 rural_dqywxbf , --城区短期险其中：意外险 rural_dqsxbf, rural_otherscale )
SELECT MAX(orders) orders ,
         branch ,
         branchtxt ,
         ins,
         mgr ,
         mgrtxt ,
         MAX(statdate) statdate ,
         SUM(sumscale) ,
         --合计总保费金额 sum(scaleallins),
         --SUM(longinsold) ,
         --合计续期保费金额 SUM(longinsnew) ,
         --合计新单保费金额 --SUM(ynqdqsx) ,
         --合计新单保费其中：一年定期寿险 SUM(longinsnewY) ,
         --合计首年期交保费金额 SUM(longinsnew5) ,
         --合计其中：5年期以下首年期交保费金额 SUM(longinsnew5_9) ,
         --合计5-9年期以下首年期交保费金额 SUM(longinsnew10) ,
         --合计10年期及以上首年期交保费金额 sum(longinsold),
         SUM(shortins) ,
         --合计短期险金额 SUM(dqywxbf),
         --合计短期险其中：意外险 sum(dqsxbf),
         sum(otherscale),
         SUM(CASE
    WHEN area_code = '0' THEN
    sumscale
    ELSE NULL END) , --城区总保费金额 SUM(CASE
    WHEN area_code = '0' THEN
    scaleallins
    ELSE NULL END) , SUM(CASE
    WHEN area_code = '0' THEN
    longinsnew
    ELSE NULL END) , --城区新单保费金额 SUM(CASE
    WHEN area_code = '0' THEN
    longinsnewY
    ELSE NULL END) , --城区首年期交保费金额 SUM(CASE
    WHEN area_code = '0' THEN
    longinsnew5
    ELSE NULL END) , --城区其中：5年期以下首年期交保费金额 SUM(CASE
    WHEN area_code = '0' THEN
    longinsnew5_9
    ELSE NULL END) , --城区5-9年期以下首年期交保费金额 SUM(CASE
    WHEN area_code = '0' THEN
    longinsnew10
    ELSE NULL END) , --城区10年期及以上首年期交保费金额 SUM(CASE
    WHEN area_code = '0' THEN
    longinsold
    ELSE NULL END) , --城区续期保费金额 SUM(CASE
    WHEN area_code = '0' THEN
    shortins
    ELSE NULL END) , --城区短期险金额 SUM(CASE
    WHEN area_code = '0' THEN
    dqywxbf
    ELSE NULL END) , --城区短期险其中：意外险 SUM(CASE
    WHEN area_code = '0' THEN
    dqsxbf
    ELSE NULL END) , --城区续期保费金额 SUM(CASE
    WHEN area_code = '0' THEN
    otherscale
    ELSE NULL END) , --城区续期保费金额 SUM(CASE
    WHEN area_code = '1' THEN
    sumscale
    ELSE NULL END) , --城区总保费金额 SUM(CASE
    WHEN area_code = '1' THEN
    scaleallins
    ELSE NULL END) , SUM(CASE
    WHEN area_code = '1' THEN
    longinsnew
    ELSE NULL END) , --城区新单保费金额 SUM(CASE
    WHEN area_code = '1' THEN
    longinsnewY
    ELSE NULL END) , --城区首年期交保费金额 SUM(CASE
    WHEN area_code = '1' THEN
    longinsnew5
    ELSE NULL END) , --城区其中：5年期以下首年期交保费金额 SUM(CASE
    WHEN area_code = '1' THEN
    longinsnew5_9
    ELSE NULL END) , --城区5-9年期以下首年期交保费金额 SUM(CASE
    WHEN area_code = '1' THEN
    longinsnew10
    ELSE NULL END) , --城区10年期及以上首年期交保费金额 SUM(CASE
    WHEN area_code = '1' THEN
    longinsold
    ELSE NULL END) , --城区续期保费金额 SUM(CASE
    WHEN area_code = '1' THEN
    shortins
    ELSE NULL END) , --城区短期险金额 SUM(CASE
    WHEN area_code = '1' THEN
    dqywxbf
    ELSE NULL END) , --城区短期险其中：意外险 SUM(CASE
    WHEN area_code = '1' THEN
    dqsxbf
    ELSE NULL END) , --城区续期保费金额 SUM(CASE
    WHEN area_code = '1' THEN
    otherscale
    ELSE NULL END) , --城区续期保费金额 SUM(CASE
    WHEN area_code = '2' THEN
    sumscale
    ELSE NULL END) , --城区总保费金额 SUM(CASE
    WHEN area_code = '2' THEN
    scaleallins
    ELSE NULL END) , SUM(CASE
    WHEN area_code = '2' THEN
    longinsnew
    ELSE NULL END) , --城区新单保费金额 SUM(CASE
    WHEN area_code = '2' THEN
    longinsnewY
    ELSE NULL END) , --城区首年期交保费金额 SUM(CASE
    WHEN area_code = '2' THEN
    longinsnew5
    ELSE NULL END) , --城区其中：5年期以下首年期交保费金额 SUM(CASE
    WHEN area_code = '2' THEN
    longinsnew5_9
    ELSE NULL END) , --城区5-9年期以下首年期交保费金额 SUM(CASE
    WHEN area_code = '2' THEN
    longinsnew10
    ELSE NULL END) , --城区10年期及以上首年期交保费金额 SUM(CASE
    WHEN area_code = '2' THEN
    longinsold
    ELSE NULL END) , --城区续期保费金额 SUM(CASE
    WHEN area_code = '2' THEN
    shortins
    ELSE NULL END) , --城区短期险金额 SUM(CASE
    WHEN area_code = '2' THEN
    dqywxbf
    ELSE NULL END) , --城区短期险其中：意外险 SUM(CASE
    WHEN area_code = '2' THEN
    dqsxbf
    ELSE NULL END) , --城区续期保费金额 SUM(CASE
    WHEN area_code = '2' THEN
    otherscale
    ELSE NULL END) --城区续期保费金额
FROM daily_sum_mgr_dn
WHERE statdate = @arg_edate
        AND branch IN 
    (SELECT branch_no
    FROM dbo.daily_udf_datapub_area_getbranch2(@arg_branch_level, @arg_branch) )
        AND ins = @arg_ins
GROUP BY  branch , branchtxt , mgr , mgrtxt, ins END
    ELSE BEGIN INSERT INTO @result ( orders , branch , branchtxt , ins, mgr , mgrtxt , statdate , total_sumscale , --城区总保费金额 total_scaleallins, total_longinsnew , --城区新单保费金额 --total_ynqdqsx , --城区新单保费其中：一年定期寿险 total_longinsnewY , --城区首年期交保费金额 total_longinsnew5 , --城区其中：5年期以下首年期交保费金额 total_longinsnew5_9 , --城区5-9年期以下首年期交保费金额 total_longinsnew10 , --城区10年期及以上首年期交保费金额 total_longinsold , --城区续期保费金额 total_shortins , --城区短期险金额 total_dqywxbf , --城区短期险其中：意外险 total_dqsxbf, total_otherscale, urban_sumscale , --城区总保费金额 urban_scaleallins, urban_longinsnew , --城区新单保费金额 --urban_ynqdqsx , --城区新单保费其中：一年定期寿险 urban_longinsnewY , --城区首年期交保费金额 urban_longinsnew5 , --城区其中：5年期以下首年期交保费金额 urban_longinsnew5_9 , --城区5-9年期以下首年期交保费金额 urban_longinsnew10 , --城区10年期及以上首年期交保费金额 urban_longinsold , --城区续期保费金额 urban_shortins , --城区短期险金额 urban_dqywxbf , --城区短期险其中：意外险 urban_dqsxbf, urban_otherscale, suburban_sumscale , --城区总保费金额 suburban_scaleallins, suburban_longinsnew , --城区新单保费金额 --suburban_ynqdqsx , --城区新单保费其中：一年定期寿险 suburban_longinsnewY , --城区首年期交保费金额 suburban_longinsnew5 , --城区其中：5年期以下首年期交保费金额 suburban_longinsnew5_9 , --城区5-9年期以下首年期交保费金额 suburban_longinsnew10 , --城区10年期及以上首年期交保费金额 suburban_longinsold , --城区续期保费金额 suburban_shortins , --城区短期险金额 suburban_dqywxbf , --城区短期险其中：意外险 suburban_dqsxbf, suburban_otherscale, rural_sumscale , --城区总保费金额 rural_scaleallins, rural_longinsnew , --城区新单保费金额 --rural_ynqdqsx , --城区新单保费其中：一年定期寿险 rural_longinsnewY , --城区首年期交保费金额 rural_longinsnew5 , --城区其中：5年期以下首年期交保费金额 rural_longinsnew5_9 , --城区5-9年期以下首年期交保费金额 rural_longinsnew10 , --城区10年期及以上首年期交保费金额 rural_longinsold , --城区续期保费金额 rural_shortins , --城区短期险金额 rural_dqywxbf , --城区短期险其中：意外险 rural_dqsxbf, rural_otherscale )
SELECT MAX(orders) orders ,
         branch ,
         branchtxt ,
         ins,
         mgr ,
         mgrtxt ,
         MAX(statdate) statdate ,
         SUM(CASE
    WHEN statdate = @arg_edate THEN
    sumscale
    WHEN statdate = @arg_sdate THEN
    -sumscale END) total_sumscale , --合计总保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    scaleallins
    WHEN statdate = @arg_sdate THEN
    -scaleallins END) total_scaleallins , --合计续期保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    longinsnew
    WHEN statdate = @arg_sdate THEN
    -longinsnew END) total_longinsnew , --合计新单保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    longinsnewY
    WHEN statdate = @arg_sdate THEN
    -longinsnewY END) total_longinsnewY , --合计首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    longinsnew5
    WHEN statdate = @arg_sdate THEN
    -longinsnew5 END) total_longinsnew5 , --合计其中：5年期以下首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    longinsnew5_9
    WHEN statdate = @arg_sdate THEN
    -longinsnew5_9 END) total_longinsnew5_9 , --合计5-9年期以下首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    longinsnew10
    WHEN statdate = @arg_sdate THEN
    -longinsnew10 END) total_longinsnew10 , --合计10年期及以上首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    longinsold
    WHEN statdate = @arg_sdate THEN
    -longinsold END) total_longinsold , SUM(CASE
    WHEN statdate = @arg_edate THEN
    shortins
    WHEN statdate = @arg_sdate THEN
    -shortins END) total_shortins , --合计短期险金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    dqywxbf
    WHEN statdate = @arg_sdate THEN
    -dqywxbf END) total_dqywxbf, --合计短期险其中：意外险 SUM(CASE
    WHEN statdate = @arg_edate THEN
    dqsxbf
    WHEN statdate = @arg_sdate THEN
    -dqsxbf END) total_dqsxbf , SUM(CASE
    WHEN statdate = @arg_edate THEN
    otherscale
    WHEN statdate = @arg_sdate THEN
    -otherscale END) total_otherscale , SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '0' THEN
    sumscale
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '0' THEN
    sumscale
    ELSE 0
    END ) END) urban_sumscale , --城区总保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '0' THEN
    scaleallins
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '0' THEN
    scaleallins
    ELSE 0
    END ) END) urban_scaleallins , --城区续期保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '0' THEN
    longinsnew
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '0' THEN
    longinsnew
    ELSE 0
    END ) END) urban_longinsnew , --城区新单保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '0' THEN
    longinsnewY
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '0' THEN
    longinsnewY
    ELSE 0
    END ) END) urban_longinsnewY , --城区首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '0' THEN
    longinsnew5
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '0' THEN
    longinsnew5
    ELSE 0
    END ) END) urban_longinsnew5 , --城区其中：5年期以下首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '0' THEN
    longinsnew5_9
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '0' THEN
    longinsnew5_9
    ELSE 0
    END ) END) urban_longinsnew5_9 , --城区5-9年期以下首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '0' THEN
    longinsnew10
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '0' THEN
    longinsnew10
    ELSE 0
    END ) END) urban_longinsnew10 , --城区10年期及以上首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '0' THEN
    longinsold
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '0' THEN
    longinsold
    ELSE 0
    END ) END) urban_longinsold , --城区新单保费其中：一年定期寿险 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '0' THEN
    shortins
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '0' THEN
    shortins
    ELSE 0
    END ) END) urban_shortins , --城区短期险金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '0' THEN
    dqywxbf
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '0' THEN
    dqywxbf
    ELSE 0
    END ) END) urban_dqywxbf , --城区短期险其中：意外险 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '0' THEN
    dqsxbf
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '0' THEN
    dqsxbf
    ELSE 0
    END ) END) urban_dqsxbf , SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '0' THEN
    otherscale
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '0' THEN
    otherscale
    ELSE 0
    END ) END) urban_otherscale , SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '1' THEN
    sumscale
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '1' THEN
    sumscale
    ELSE 0
    END ) END) suburban_sumscale , --县城总保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '1' THEN
    scaleallins
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '1' THEN
    scaleallins
    ELSE 0
    END ) END) suburban_scaleallins , --县城续期保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '1' THEN
    longinsnew
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '1' THEN
    longinsnew
    ELSE 0
    END ) END) suburban_longinsnew , --县城新单保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '1' THEN
    longinsnewY
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '1' THEN
    longinsnewY
    ELSE 0
    END ) END) suburban_longinsnewY , --县城首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '1' THEN
    longinsnew5
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '1' THEN
    longinsnew5
    ELSE 0
    END ) END) suburban_longinsnew5 , --县城其中：5年期以下首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '1' THEN
    longinsnew5_9
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '1' THEN
    longinsnew5_9
    ELSE 0
    END ) END) suburban_longinsnew5_9 , --县城5-9年期以下首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '1' THEN
    longinsnew10
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '1' THEN
    longinsnew10
    ELSE 0
    END ) END) suburban_longinsnew10 , --县城10年期及以上首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '1' THEN
    longinsold
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '1' THEN
    longinsold
    ELSE 0
    END ) END) suburban_longinsold , SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '1' THEN
    shortins
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '1' THEN
    shortins
    ELSE 0
    END ) END) suburban_shortins , --县城短期险金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '1' THEN
    dqywxbf
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '1' THEN
    dqywxbf
    ELSE 0
    END ) END) suburban_dqywxbf , --县城短期险其中：意外险 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '1' THEN
    dqsxbf
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '1' THEN
    dqsxbf
    ELSE 0
    END ) END) suburban_dqsfxb , SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '1' THEN
    otherscale
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '1' THEN
    otherscale
    ELSE 0
    END ) END) suburban_otherscale , SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '2' THEN
    sumscale
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '2' THEN
    sumscale
    ELSE 0
    END ) END) rural_sumscale , --农村总保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '2' THEN
    scaleallins
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '2' THEN
    scaleallins
    ELSE 0
    END ) END) rural_scaleallins , --农村续期保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '2' THEN
    longinsnew
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '2' THEN
    longinsnew
    ELSE 0
    END ) END) rural_longinsnew , --农村新单保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '2' THEN
    longinsnewY
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '2' THEN
    longinsnewY
    ELSE 0
    END ) END) rural_longinsnewY , --农村首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '2' THEN
    longinsnew5
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '2' THEN
    longinsnew5
    ELSE 0
    END ) END) rural_longinsnew5 , --农村其中：5年期以下首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '2' THEN
    longinsnew5_9
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '2' THEN
    longinsnew5_9
    ELSE 0
    END ) END) rural_longinsnew5_9 , --农村5-9年期以下首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '2' THEN
    longinsnew10
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '2' THEN
    longinsnew10
    ELSE 0
    END ) END) rural_longinsnew10 , --农村10年期及以上首年期交保费金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '2' THEN
    longinsold
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '2' THEN
    longinsold
    ELSE 0
    END ) END) rural_longinsold , SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '2' THEN
    shortins
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '2' THEN
    shortins
    ELSE 0
    END ) END) rural_shortins , --农村短期险金额 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '2' THEN
    dqywxbf
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '2' THEN
    dqywxbf
    ELSE 0
    END ) END) rural_dqywxbf , --农村短期险其中：意外险 SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '2' THEN
    dqsxbf
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '2' THEN
    dqsxbf
    ELSE 0
    END ) END) rural_dqsxbf , SUM(CASE
    WHEN statdate = @arg_edate THEN
    (
    CASE
    WHEN area_code = '2' THEN
    otherscale
    ELSE 0
    END )
    WHEN statdate = @arg_sdate THEN
    -(
    CASE
    WHEN area_code = '2' THEN
    otherscale
    ELSE 0
    END ) END) rural_otherscale
FROM daily_sum_mgr_dn
WHERE statdate IN ( @arg_sdate, @arg_edate )
        AND branch IN 
    (SELECT branch_no
    FROM dbo.daily_udf_datapub_area_getbranch2(@arg_branch_level, @arg_branch) )
        AND ins = @arg_ins
GROUP BY  branch , branchtxt , mgr , mgrtxt, ins
    END RETURN
    END GO 
